# 목차
- [Hex Cpde 헥사코드](#hex-code-hexadecimal-헥사코드)
- [IPSec](#ipsec)

<br>
<br>

## Hex Code (Hexadecimal)  헥사코드
---
</br>
<strong>헥사 값</strong>: 16진법을 표기하기 위한 값</br></br>

16진법을 사용하는 이유?</br>
16진수 하나가 2의 4승을 표현할 수 있기 때문에 8비트씩 단위가 딱딱 맞아 떨여줘서 사용하기 좋다. 
</br></br>

<strong>특징</strong></br></br>
일반적으로 뒤에서부터 2자리씩 끊어 읽는다. </br>
4567 -> 45 67,  89ABC ->08 9A BC,</br></br>
기록할때는 두자리씩 역순으로 적어 넣는다.</br>
 45 67 -> 67 45, 08 9A BC -> BC 9A 08</br></br>
 끊어읽지 않을 경우 보통 10진수와 구분하기 위해 'h'를 붙여준다.</br>
  457h, 50AE9h</br></br>
0x는 16 진수임을 표기하기 위해 붙인다.  </br></br></br>
 
<strong>변환연습</strong>

16진법 -> 2진법

0x25FB => 0010 0101 1111 1011 => 00을 떼주고 10010111111011(2)로 적는다.</br></br>

2진법 -> 16진법

10111010101010101011110100010(2) => 4개씩 끊어줌 => 0001 0111 0101 0101 0101 0111 1010 0010 => 0x175557A2</br></br>

10진법 -> 16진법

16(10) => 0x10</br></br></br>
<strong>16진수 표</strong></br></br>
![title](/Image/hexCode.gif)

## IPSec
---
</br>
<strong>IPsec이란?</strong></br>
네트워크에서의 안전한 연결을 설정하기 위한 통신 규칙 또는 프로토콜 세트이다. 인터넷 프로토콜(IP)은 데이터가 인터넷에서 전송되는 방식을 결정하는 공통 표준으로 IPsec은 암호화와 인증을 추가하여 프로토콜을 더 안전하게 만든다. 예를 들면 IPsec은 데이터를 소스에서 암호화한 다음 대상에서 복호화한다. 그리고 데이터의 소스도 인증한다. </br></br>

<strong>IPsec이 중요한 이유?</strong></br>
Internet Engineering Task Force 는 퍼블릭 네트워크에 엑세스 할 때 데이터의 기밀성, 무결성 및 신뢰성을 보장하기 위해 1990 년대에 IPSec을 개발했다. 예를 들어 사용자는 IPSec가상 프라이빗 네트워크(VPN)를 통해 인터넷에 연결하여 원격으로 회사 파일에 엑세스한다. IPSec프로토콜은 중요한 정보를 암호화하여 원치 않는 모니터링을 방지한다. 또한 서버는 수신된 데이터 패킷이 인증되었는지 확인할 수 있다. </br></br>

<strong>IPsec은 어디에 사용될까?</strong></br>
- 퍼블릭 인터넷을 통해 데이터를 전송할 때 라우터 보안을 제공한다.
- 애플리케이션 데이터를 암호화한다.
- 알려진 발신자가 보낸 데이터를 빠르게 인증한다.
- 두 엔드포인트 간에 전송되는 모든 데이터를 암호화하는 , IPsec 터널이라는 암호화된 회로를 설정하여 네트워크 데이터를 보호한다.

조직은 IPsec을 사용하여 리플레이 공격으로부터 보호한다. 리플레이 공격 또는 중간자(MITM) 공격은 중간 컴퓨터로 데이터를 라우팅하여 진행중인 전송을 가로채고 변경하는 행위이다. IPsec 프로토콜은 각 데이터 패킷에 순차적 번호를 할당하고 검사를 수행하여 중복 패킷의 징후를 탐지한다. </br></br>

<strong>IPsec은 어떻게 작동하나?</strong></br>
컴퓨터는 다음 단계를 통해 IPsec 프로토콜을 사용하여 데이터를 교환한다.
- 발신 컴퓨터는 보안 정책을 확인하여 데이터를 전송하는 데 IPSec 보호가 필요한지 여부를 확인합니다. IPSec 보호가 필요한 경우 컴퓨터는 수신 컴퓨터로의 보안 IPSec 전송을 시작합니다.
- 두 컴퓨터 모두 보안 연결을 설정하기 위해 요구 사항을 협상합니다. 여기에는 암호화, 인증 및 기타 보안 연결(SA) 파라미터에 대한 상호 동의가 포함됩니다. 
- 컴퓨터는 암호화된 데이터를 주고받으며 신뢰할 수 있는 소스에서 전송되었는지 확인합니다. 기본 콘텐츠의 신뢰성을 확인하기 위해 검사를 수행합니다. 
- 전송이 완료되거나 세션이 시간 초과되면 컴퓨터는 IPSec 연결을 종료합니다. </br></br>

<strong>IPsec 프로토콜은 어떤 것들이 있나?</strong></br>

IPSec 프로토콜은 데이터 패킷을 안전하게 전송합니다. 데이터 패킷은 네트워크 전송을 위해 정보를 포맷하고 준비하는 특정 구조이며, 헤더, 페이로드 및 트레일러로 구성됩니다.</br></br>

- 헤더는 데이터 패킷을 올바른 대상으로 라우팅하기 위한 지침 정보가 포함된 선행 섹션입니다. 
- 페이로드는 데이터 패킷에 포함된 실제 정보를 나타내는 용어입니다.
- 트레일러는 데이터 패킷의 끝을 나타내기 위해 페이로드의 끝에 추가되는 추가 데이터입니다. 

 아래에 몇 가지 IPSec 프로토콜이 나와 있습니다.

인증 헤더(AH)</br>
인증 헤더(AH) 프로토콜은 발신자 인증 데이터가 포함된 헤더를 추가하고, 권한이 없는 당사자가 수정하지 못하도록 패킷 콘텐츠를 보호합니다. 수신자에게 원본 데이터 패킷이 조작되었을 가능성을 경고합니다. 데이터 패킷을 수신할 때 컴퓨터는 페이로드의 암호화 해시 계산 결과를 헤더와 비교하여 두 값이 일치하는지 확인합니다. 암호화 해시는 데이터를 고유한 값으로 요약하는 수학 함수입니다. 

보안 페이로드 캡슐화(ESP)</br>
선택한 IPSec 모드에 따라, 보안 페이로드 캡슐화(ESP) 프로토콜은 전체 IP 패킷 또는 페이로드에 대해서만 암호화를 수행합니다. ESP는 암호화할 때 데이터 패킷에 헤더와 트레일러를 추가합니다. 

Internet Key Exchange(IKE)</br>
Internet Key Exchange(IKE)는 인터넷에서 두 디바이스 간에 보안 연결을 설정하는 프로토콜입니다. 두 디바이스 모두 암호화 키 및 알고리즘을 협상하여 후속 데이터 패킷을 송수신하는 보안 연결(SA)을 설정합니다. </br></br></br>

<strong>IPsec 모드는 어떤 것들이 있나?</strong></br>
IPSec은 보호 수준이 서로 다른 두 가지 모드로 작동합니다. 

터널

IPSec 터널 모드는 권한이 없는 당사자로부터의 데이터 보호를 강화하므로, 퍼블릭 네트워크의 데이터를 전송하는 데 적합합니다. 컴퓨터가 페이로드와 헤더를 포함한 모든 데이터를 암호화하고, 데이터에 새 헤더를 추가합니다. 

전송

IPSec 전송 모드는 데이터 패킷의 페이로드만 암호화하고 IP 헤더를 원래 형식으로 유지합니다. 암호화되지 않은 패킷 헤더를 통해 라우터는 각 데이터 패킷의 대상 주소를 식별할 수 있습니다. 따라서 IPSec 전송은 두 컴퓨터 간의 직접 연결을 보호하는 경우처럼, 가깝고 신뢰할 수 있는 네트워크에서 사용됩니다. </br>
</br>
</br>


<strong>IPsec VPN이란 ?</strong></br>
VPN 또는 가상 프라이빗 네트워크는 사용자가 익명으로 안전하게 인터넷을 검색할 수 있도록 하는 네트워킹 소프트웨어입니다. IPSec VPN은 IPSec 프로토콜을 사용하여 인터넷에 암호화된 터널을 생성하는 VPN 소프트웨어이며, 엔드 투 엔드 암호화를 제공합니다. 즉, 데이터가 컴퓨터에서 스크램블되고 수신 서버에서 스크램블 해제됩니다. 

SSL VPN </br>
SSL은 보안 소켓 계층을 의미하며 웹 트래픽을 보호하는 보안 프로토콜입니다. SSL VPN은 기본 SSL 프로토콜을 사용하여 네트워크 통신을 암호화하고 보호하는 브라우저 기반 네트워크 보안 서비스입니다. 

IPSec VPN과 SSL VPN의 차이점은 무엇인가요?</br>
두 보안 프로토콜 모두 오픈 시스템 상호 연결(OSI) 모델의 서로 다른 계층에서 작동합니다. OSI 모델은 컴퓨터가 네트워크에서 데이터를 교환하는 방식의 계층 구조를 정의합니다. 

IPSec 프로토콜은 OSI 모델의 중간에 있는 네트워크 및 전송 계층에 적용됩니다. 반면, SSL은 최상위 애플리케이션 계층의 데이터를 암호화합니다. 웹 브라우저에서 SSL VPN에 연결할 수 있지만, IPSec VPN을 사용하려면 별도의 소프트웨어를 설치해야 합니다.</br></br>

## IKE
---
</br>
</br>
<strong>IKEv2와 IKEv1이란?</strong></br>

IKEv2와 IKEv1은 IKE(Internet Key Exchange, 두 네트워크 간의 통신 채널을 설정하는 데 사용되는 프로토콜)의 두 가지 버전입니다.

IKEv2는 IKEv1이 향상된 버전입니다. IKEv2와 IKEv1은 그 핵심이 매우 유사하지만 IKEv2는 IKEv1보다 더 빠르며 안전하고 안정적이게 설계되었습니다. </br></br>

속도: IKEv2는 IKEv1보다 훨씬 더 빠른 속도를 제공합니다. IKEv2는 NAT 통과를 기본으로 지원하여 훨씬 빠르게 연결을 설정하고 방화벽을 통과할 수 있습니다. IKEv2는 이동성 및 다중 호밍 프로토콜(MOBIKE, Mobility and Multi-homing Protocol)을 지원하므로 와이파이와 모바일 네트워크 간을 전환할 때 거의 즉시 재연결할 수 있습니다. 또한 대역폭 측면에서 IKEv2는 VPN 터널을 설정하는 데 필요한 보안 연결이 더 적기 때문에 IKEv1보다 대역폭을 덜 사용합니다.</br>

보안: IKEv2는 IKEv1보다 훨씬 더 안전합니다. IKEv2는 AES, Camellia, ChaCha20 같은 고급 암호와 일류 암호화 알고리즘을 사용합니다. IKEv2는 양쪽 모두에 암호화 키를 사용하므로 그렇지 않은 IKEv1보다 더욱 안전합니다.

일반적으로 기업 네트워크에서 사용되는 매우 안전한 인증 방법인 EAP에 대한 지원을 포함하는 IKEv2는 가장 안전한 VPN 프로토콜 중 하나입니다. 

안정성: IKEv2는 모든 통신이 메시지 쌍(요청과 응답)으로 구성되어 이와 같은 방식으로 작동하지 않는 IKEv1보다 더 안정적입니다. 또한 IKEv2의 MOBIKE 지원은 네트워크 변경에 대한 연결을 보다 강력하게 만듭니다.</br></br></br>

<strong>StrongSwan</strong></br>
</br>
</br>
구글 이나 AWS 등의 Public Cloud 를 사용하는 경우, 또 해외 등에 IDC를 운영할 경우 터미널이나 중요한 포트 접근시 중계서버를 거치거나 공인IP를 통해 접속을 해야하는 경우가 발생하게 된다.
 이 경우 DB 서버나 개인정보등 중요한 데이터를 보관하고 있는 서버는 공인IP가 아닌 사설 IP만으로 통신하게 구성하는것이 안전하다. 이를 위해서는 VPN 가상 사설 망을 구성하여 내부 사설 IP끼리 통신이 가능하도록 구성할 수 있다.

  AWS나 구글 클라우드와 같은 유명 클라우드 업체에서는 전용 VPN 솔루션을 제공해 주고 있으며 약간의 비용을 지불하여 해당 VPN을 사용하는 것이 운영 측면에서 훨신 편리하다.  
 그러나 VPN 을 제공해주지 않는 업체도 있어서 이럴경우에 오픈소스를 활용하여 별도 VPN을 구축하여 사용할 수 있다. 이 글에서는 오픈소스 VPN 중 StrongSwan 에 대해 알아보고 설치 및 설정하는 방법을 설명하려고 한다. 

StrongSwan
  - StrongSwan은 OpenSource IPsec 기반 VPN 솔루션으로 IKEv1 및 IKEv2 ( RFC 7296 ) 키 교환 프로토콜을 모두 구현하며, 가장 강력한 인증 메커니즘에 포커스를 맟춘 프로젝트 이다.
  - 또한 멀티플랫폼 IPSEC을 구현하여, 타사 벤더의 방화벽이나 VPN 장비와 문제 없이 연동이 가능하다.
  </br>
</br>

의미
- strongSwan은 다중플랫폼 IPsec 구현체임.

- strongSwan 프로젝트, 아래를 사용한 강력한(strong) 인증 메커니즘이 목표임.

  - X.509 키 인증서

  - 선택적인 private keys의 안전한 stroage

  - smartcards에 있는 인증서들 (표준화된 PKCS#11 인터페이스를 통해서)

  - TRM 2.0에 있는 인증서들.

- strongswan은 KVM에 기반 시뮬레이션 환경과 같이 제공됨.

즉, 다중플랫폼에서 돌아가는 IPsec을 구현한 것이 strongSwan임.

 

- strongSwan의 현재 버전은 완전히 RFC 7296에 정의된, Internet Key Exchange (IKEv2) protocol을 구현하였음.

- strongSwan is a multiplatform IPsec implementation. The focus of the project is on strong authentication mechanisms using X.509 public key certificates and optional secure storage of private keys and certificates on smartcards through a standardized PKCS#11 interface and on TPM 2.0. (https://en.wikipedia.org/wiki/StrongSwan)

→ IP Sec VPN을 지원하는 오픈소스 솔루션 정도로 이해하자